<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous">
</head>
<style>
    /* Global Variables */
    :root {
        /* Light Mode */
        --lightbg: rgba(255, 255, 255, 0.4);
        --lightcolor: #000;
        --lightinputfocus: rgba(255, 255, 255, 0.6);
        /* Dark Mode */
        --darkbg: rgba(0, 0, 0, 0.4);
        --darkcolor: #cfcfcf;
        --darkinputfocus: rgba(0, 0, 0, 0.6);
    }

    /* Jika tema adalah 'dark' */
    html[data-bs-theme="dark"] {
        background-color: var(--darkbg);

        /* Window Area */
        .card {
            position: relative;
            display: flex;
            flex-direction: column;
            /* Menetapkan arah fleksibilitas ke vertikal */
            min-width: 0;
            word-wrap: break-word;
            background-color: var(--darkbg);
            color: var(--darkcolor);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            backdrop-filter: blur(20px);
            padding: 0px;
            /* Experimental : add padding on inside contents */
            height: 100%;
            /* Kartu akan mengisi tinggi kolom */
        }

        .card .card-body {
            flex-grow: 1;
            /* Kartu akan mengisi tinggi dengan isi konten */
            overflow-x: auto;
            display: flex;
            /* Memastikan konten kartu juga berfleksibel */
            flex-direction: column;
            /* Memastikan konten kartu berfleksibel secara vertikal */
        }

        .input-mica {
            background-color: var(--darkbg);
            border: 0;
        }

        .input-mica:focus {
            background-color: var(--darkinputfocus);
            color: var(--darkcolor);
        }

        /* Experimental : Preload Page */
        .preload-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--darkbg);
            /* Fallback color */
            backdrop-filter: blur(10px);
            /* Acrylic effect */
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.3s ease;
        }

        /* Hide Preload Page */
        .preload-hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Loading Bar Styles */
        progress {
            width: 200px;
            height: 20px;
            appearance: none;
            border: none;
            border-radius: 15px;
        }

        progress::-webkit-progress-bar {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
        }

        progress::-webkit-progress-value {
            background: rgba(255, 255, 255, 0.5);
            transition: width 0.3s ease;
            border-radius: 15px;
        }
    }

    /* Jika tema adalah 'light' */
    html[data-bs-theme="light"] {
        background-color: var(--lightbg);
        /* Contoh warna background untuk light mode */
        color: var(--lightcolor);
        /* Warna teks gelap untuk light mode */

        /* Window Area */
        .card {
            position: relative;
            display: flex;
            flex-direction: column;
            /* Menetapkan arah fleksibilitas ke vertikal */
            min-width: 0;
            word-wrap: break-word;
            background-color: var(--lightbg);
            color: var(--lightcolor);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            backdrop-filter: blur(20px);
            padding: 0px;
            /* Experimental : add padding on inside contents */
            height: 100%;
            /* Kartu akan mengisi tinggi kolom */
        }

        .card .card-body {
            flex-grow: 1;
            /* Kartu akan mengisi tinggi dengan isi konten */
            overflow-x: auto;
            display: flex;
            /* Memastikan konten kartu juga berfleksibel */
            flex-direction: column;
            /* Memastikan konten kartu berfleksibel secara vertikal */
        }

        .input-mica {
            background-color: var(--lightbg);
            color: var(--darkcolor);
            border: 0;
        }

        .input-mica:focus {
            background-color: var(--lightinputfocus);
            color: var(--lightcolor);
        }

        /* Experimental : Preload Page */
        .preload-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.5);
            /* Fallback color */
            backdrop-filter: blur(10px);
            /* Acrylic effect */
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.3s ease;
        }

        /* Hide Preload Page */
        .preload-hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Loading Bar Styles */
        progress {
            width: 200px;
            height: 20px;
            appearance: none;
            border: none;
            border-radius: 15px;
        }

        progress::-webkit-progress-bar {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
        }

        progress::-webkit-progress-value {
            background: rgba(18, 18, 18, 0.5);
            transition: width 0.3s ease;
            border-radius: 15px;
        }
    }

    /* Body styles and backgrounds */
    body {
        background: url('https://picsum.photos/1920/1080') no-repeat center center fixed;
        background-size: cover;
        display: flex;
        min-height: 100vh;
        flex-direction: column;
        transition: background-color 0.3s, color 0.3s;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    /* Container height */
    .parent {
        min-height: 95vh;
    }

    .footer {
        height: 5vh;
        color: white;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        font-weight: lighter;
    }

    .clock {
        font-size: 8vh;
        position: relative;
        text-align: center;
        color: rgb(255, 255, 255);
        margin-bottom: 0;
    }

    .clock-period {
        font-family: 'Courier New', Courier, monospace;
        font-size: 6vh;
        color: rgba(0, 0, 255, 0.747);
    }

    .btn-mica-blue {
        background-color: rgba(0, 0, 255, 0.4);
        color: #fff;
        backdrop-filter: blur(20px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .btn-mica-blue:hover {
        background-color: rgba(0, 0, 255, 0.6);
    }

    .btn-settings {
        position: fixed;
        /* Tetap di tempat saat scroll */
        top: 10px;
        /* Jarak dari bagian atas */
        right: 10px;
        /* Jarak dari bagian kanan */
        background-color: rgba(255, 0, 0, 0.4);
        /* Warna background */
        color: #fff;
    }

    .btn-settings:hover {
        background-color: rgba(255, 0, 0, 0.6);
    }

    /* Maps Height */
    #infoMaps {
        height: 30vh;
    }
</style>

<body>
    <!-- Preload Page -->
    <div id="preload" class="preload-page">
        <progress id="loading-bar" value="0" max="100"></progress>
    </div>
    <!-- Floating Buttons -->
    <button class="btn btn-settings" data-bs-toggle="modal" data-bs-target="#settingsModal"><i
            class="bi bi-gear"></i></button>
    <!-- Clock & Search Area -->
    <div class="parent container d-flex justify-content-center align-items-center h-100 w-100">
        <div class="row">
            <div class="col-12 mb-0">
                <h1 class="text-start clock">Wait...</h1>
                <h6 class="pt-0 h-6" id="location-info"></h6>
            </div>
            <form action="https://www.google.com/search" method="get">
                <div class="col-12 mb-2">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-10 px-2">
                                    <div class="form-floating">
                                        <input type="text" class="form-control input-mica" name="q"
                                            placeholder="Search Here..." id="searchInput" required>
                                        <label for="searchInput">Search for...</label>
                                    </div>
                                </div>
                                <div class="col-2 ps-0 pe-2">
                                    <button type="submit" class="btn btn-mica-blue w-100 h-100"><i
                                            class="bi-search"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <div class="col-12" id="weather-panel">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12 mb-2">
                                <div class="row">
                                    <div class="col-8">
                                        <h5 class="display-5">Weather Info</h5>
                                    </div>
                                    <div class="col-4">
                                        <button type="button" id="btnInfo" class="btn float-end" data-bs-toggle="modal"
                                            data-bs-target="#infoModal">
                                            <i class="bi bi-info-circle-fill"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-8 mb-2">
                                <div class="d-flex justify-content-center align-items-center">
                                    <div class="row">
                                        <div class="col-12">
                                            <div id="weather-icons">
                                                <!-- Weather Icons -->
                                            </div>
                                        </div>
                                        <div class="col">
                                            <h5 class="text-center" id="weather-name">
                                                <!-- Weather Status -->
                                            </h5>
                                            <p class="text-center text-capitalize" id="current-temp-data">
                                                <!-- Temperature data -->
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-4">
                                <div class="row">
                                    <div class="col-6 col-sm-6 col-lg-12 px-1 mb-2 d-none d-sm-none d-md-block">
                                        <div class="card">
                                            <div class="card-body">
                                                <p class="m-0" id="weather-precipitation">
                                                    <!-- Weather precipitation -->
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-sm-6 col-lg-12 px-1 mb-2 d-none d-sm-none d-md-block">
                                        <div class="card">
                                            <div class="card-body">
                                                <p class="m-0" id="wind-info">
                                                    <!-- Wind informations -->
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12 col-lg-12 px-1 mb-2 d-block d-sm-block d-md-none">
                                        <div class="card">
                                            <div class="card-body">
                                                <div id="carouselInformation" class="carousel slide"
                                                    data-bs-ride="carousel">
                                                    <div class="carousel-inner" id="carousel-content">
                                                        <!-- Carousel Content Sections -->
                                                    </div>
                                                    <button class="carousel-control-prev" type="button"
                                                        data-bs-target="#carouselInformation" data-bs-slide="prev">
                                                        <span class="carousel-control-prev-icon"
                                                            aria-hidden="true"></span>
                                                        <span class="visually-hidden">Previous</span>
                                                    </button>
                                                    <button class="carousel-control-next" type="button"
                                                        data-bs-target="#carouselInformation" data-bs-slide="next">
                                                        <span class="carousel-control-next-icon"
                                                            aria-hidden="true"></span>
                                                        <span class="visually-hidden">Next</span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabels" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title fs-5" id="settingsModalLabels"><i class="bi bi-gear"></i> Settings</h2>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm-12 col-lg-6 mb-2">
                            <div class="row">
                                <div class="col-8">
                                    <p>Hide Weather Panel</p>
                                </div>
                                <div class="col-4">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch"
                                            id="switchWeatherPanel">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 col-lg-6 mb-2">
                            <div class="row">
                                <div class="col-8">
                                    <p>Options 2</p>
                                </div>
                                <div class="col-4">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch" id="switch2">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Information Modal -->
    <div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabels" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title fs-5" id="infoModalLabels"><i class="bi bi-info-circle-fill"></i> Weather &
                        Location Details</h2>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-12 mb-2">
                            <h5 class="h5"><i class="bi bi-pin-map"></i> Address Information</h5>
                        </div>
                        <div class="col-12 mb-2">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-12 col-lg-4">
                                            <h6><i class="bi bi-crosshair"></i> Current Location</h6>
                                        </div>
                                        <div class="col-12 col-lg-8">
                                            <p id="infoLocation" class="mb-0"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-2">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-12 col-lg-4">
                                            <h6><i class="bi bi-arrows"></i> Latitude</h6>
                                        </div>
                                        <div class="col-12 col-lg-8">
                                            <p id="infoLatitude" class="mb-0"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-2">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-12 col-lg-4">
                                            <h6 class="bi bi-arrows-vertical"> Longitude</h6>
                                        </div>
                                        <div class="col-12 col-lg-8">
                                            <p id="infoLongitude" class="mb-0"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <div class="card">
                                <div class="card-body">
                                    <div id="infoMaps">
                                        <!-- Maps Area -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Line Divider and New Titles -->
                        <div class="col-12 mb-2">
                            <hr>
                            <h5 class="h5"><i class="bi bi-thermometer-sun"></i> Weather Forecast</h5>
                        </div>
                        <div class="col-12 col-lg-6 mb-2">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-12 mb-2">
                                            <h6><i class="bi bi-calendar-day"></i> Daily</h6>
                                        </div>

                                        <div class="col-12 table-responsive">
                                            <table id="hourly-forecast-table" class="table table-borderless">
                                                <tr>
                                                    <!-- Content -->
                                                </tr>
                                            </table>
                                        </div>

                                        <div class="col-12 mb-2">
                                            <h6><i class="bi bi-calendar-week"></i> Weekly</h6>
                                        </div>
                                        
                                        <div id="table" class="col-12">
                                            <table id="daily-forecast-table" class="table table-borderless">
                                                <thead>
                                                    <tr>
                                                        <th><i class="bi bi-calendar-date"></i></th>
                                                        <th><i class="bi bi-cloud-sun-fill"></i></th>
                                                        <th><i class="bi bi-thermometer-low"></i></th>
                                                        <th><i class="bi bi-thermometer-high"></i></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Content -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer px-2">
        <p>
            <script>
                document.write(new Date().getFullYear())
            </script> authntc<span style="color: blue;">G!</span>
        </p>
    </footer>
</body>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
</script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
<script>
    // Initiator variable
    var maps;
    var marker;
    var radius;
    var latitude;
    var longitude;

    // Fungsi untuk memperbarui jam setiap detik
    function updateClock() {
        var currentTime = new Date();
        var hours = currentTime.getHours();
        var minutes = currentTime.getMinutes();
        var seconds = currentTime.getSeconds();
        var period = "AM";

        // Ubah format jam 24 jam ke 12 jam
        if (hours >= 12) {
            period = "PM";
            if (hours > 12) {
                hours -= 12;
            }
        } else if (hours === 0) {
            hours = 12;
        }

        // Tambahkan angka 0 jika menit atau detik kurang dari 10
        if (minutes < 10) {
            minutes = "0" + minutes;
        }

        if (seconds < 10) {
            seconds = "0" + seconds;
        }

        // Perbarui elemen clock dan clock-period
        $(".clock").html(hours + ":" + minutes + ":" + seconds + " <span class='clock-period'>" + period +
            "</span>"); // Gabungkan clock dan period
    }

    // Panggil fungsi updateClock setiap detik
    $(document).ready(function () {
        updateClock(); // Jalankan sekali saat halaman dimuat
        setInterval(updateClock, 1000); // Jalankan setiap detik
    });

    // Bootstrap Auto Theme
    (function () {
        const htmlElement = document.querySelector("html")
        if (htmlElement.getAttribute("data-bs-theme") === 'auto') {
            function updateTheme() {
                document.querySelector("html").setAttribute("data-bs-theme",
                    window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light")
            }

            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateTheme)
            updateTheme()
        }
    })();

    // Save State
    function saveState() {
        sessionStorage.setItem('isWeatherPanelHidden', switchWeatherPanel.checked);
    }

    // Load State
    const weatherPanel = document.getElementById('weather-panel');

    function loadState() {
        const savedState = sessionStorage.getItem('isWeatherPanelHidden');
        if (savedState !== null) {
            const isHidden = savedState === 'true';
            switchWeatherPanel.checked = isHidden;

            if (isHidden) {
                weatherPanel.setAttribute('hidden', true);
            } else {
                weatherPanel.removeAttribute('hidden');
            }


        }
    }

    // Switch Weather Panel
    const switchWeatherPanel = document.getElementById('switchWeatherPanel');
    switchWeatherPanel.addEventListener('change', function () {
        if (this.checked) {
            weatherPanel.setAttribute('hidden', true);
        } else {
            weatherPanel.removeAttribute('hidden');
        }

        saveState();
    });

    // Load Data From Sessions
    window.addEventListener('load', loadState);

    // Function to hide preload page
    function hidePreload() {
        document.getElementById('preload').classList.add('preload-hidden');
    }

    function animateProgressBar() {
        const loadingBar = document.getElementById('loading-bar');
        let progress = 0;
        const interval = setInterval(() => {
            if (progress < 90) {
                progress += 1;
                loadingBar.value = progress;
            } else {
                clearInterval(interval);
            }
        }, 15); // Adjust the interval to control the speed
    }

    // Loading animation sections
    window.addEventListener('load', hidePreload);
    document.onreadystatechange = function () {
        const loadingBar = document.getElementById('loading-bar');
        console.log(document.readyState);
        if (document.readyState === 'interactive') {
            animateProgressBar();
        } else if (document.readyState === 'complete') {
            loadingBar.value = 100;
            hidePreload();
        }
    };

    // Visibility Sections
    function convertVisibilityValue(visibility) {
        return visibility / 100;
    }

    // UV Sections
    function getUVIndexInfo(uv) {
        let uvScale;
        let recommendation;

        if (uvIndex >= 0 && uvIndex <= 2) {
            uvScale = "Rendah";
            recommendation = "Paparan sinar UV minimal, Anda dapat berada di luar ruangan tanpa perlindungan tambahan, tetapi tetap gunakan kacamata hitam jika perlu.";
        } else if (uvIndex >= 3 && uvIndex <= 5) {
            uvScale = "Sedang";
            recommendation = "Paparan sinar UV sedang. Gunakan tabir surya, kacamata hitam, dan perlindungan tambahan jika beraktivitas lama di luar ruangan.";
        } else if (uvIndex >= 6 && uvIndex <= 7) {
            uvScale = "Tinggi";
            recommendation = "Paparan sinar UV tinggi. Gunakan perlindungan penuh seperti tabir surya, pakaian pelindung, dan topi. Hindari berada di luar ruangan pada tengah hari.";
        } else if (uvIndex >= 8 && uvIndex <= 10) {
            uvScale = "Sangat Tinggi";
            recommendation = "Paparan sinar UV sangat tinggi. Gunakan perlindungan maksimum, hindari paparan langsung. Sebaiknya tetap berada di tempat teduh.";
        } else if (uvIndex >= 11) {
            uvScale = "Ekstrem";
            recommendation = "Paparan sinar UV ekstrem. Sangat penting untuk menghindari paparan sinar matahari langsung. Gunakan perlindungan maksimal (tabir surya, pakaian pelindung, topi, dan kacamata hitam).";
        } else {
            uvScale = "Tidak valid";
            recommendation = "Nilai UV tidak valid. Pastikan nilai UV yang dimasukkan benar.";
        }

        return {
            uvScale: uvScale,
            recommendation: recommendation
        };
    }

    // Weather sections 
    function getWindDirection(degree) {
        if ((degree >= 337.5 && degree <= 360) || (degree >= 0 && degree < 22.5)) {
            return "Utara";
        } else if (degree >= 22.5 && degree < 67.5) {
            return "Timur Laut";
        } else if (degree >= 67.5 && degree < 112.5) {
            return "Timur";
        } else if (degree >= 112.5 && degree < 157.5) {
            return "Tenggara";
        } else if (degree >= 157.5 && degree < 202.5) {
            return "Selatan";
        } else if (degree >= 202.5 && degree < 247.5) {
            return "Barat Daya";
        } else if (degree >= 247.5 && degree < 292.5) {
            return "Barat";
        } else if (degree >= 292.5 && degree < 337.5) {
            return "Barat Laut";
        } else {
            return "Arah tidak diketahui";
        }
    }

    function setWeatherData(weatherCode) {
        // Map `weather_code` ke ikon Bootstrap Icons
        const weatherIcons = {
            0: 'bi-sun', // Cerah
            1: 'bi-cloud-sun', // Sebagian berawan
            2: 'bi-cloud', // Berawan
            3: 'bi-clouds', // Sangat berawan
            45: 'bi-cloud-fog', // Kabut
            48: 'bi-cloud-fog', // Kabut tebal
            51: 'bi-cloud-drizzle', // Gerimis ringan
            53: 'bi-cloud-drizzle', // Gerimis sedang
            55: 'bi-cloud-drizzle', // Gerimis berat
            56: 'bi-cloud-drizzle', // Gerimis beku ringan
            57: 'bi-cloud-drizzle', // Gerimis beku berat
            61: 'bi-cloud-rain', // Hujan ringan
            63: 'bi-cloud-rain', // Hujan sedang
            65: 'bi-cloud-rain-heavy', // Hujan berat
            66: 'bi-cloud-rain', // Hujan beku ringan
            67: 'bi-cloud-rain-heavy', // Hujan beku berat
            71: 'bi-cloud-snow', // Salju ringan
            73: 'bi-cloud-snow', // Salju sedang
            75: 'bi-cloud-snow', // Salju berat
            77: 'bi-cloud-snow', // Butiran salju
            80: 'bi-cloud-rain', // Hujan ringan deras
            81: 'bi-cloud-rain-heavy', // Hujan sedang deras
            82: 'bi-cloud-rain-heavy', // Hujan berat deras
            85: 'bi-cloud-snow', // Salju ringan
            86: 'bi-cloud-snow-heavy', // Salju berat
            95: 'bi-cloud-lightning', // Badai petir ringan
            96: 'bi-cloud-lightning-rain', // Badai petir dengan hujan ringan
            99: 'bi-cloud-lightning-rain', // Badai petir dengan hujan berat
        };

        // Map `weather_code` ke pesan cuaca
        const weatherMessages = {
            0: 'Cerah sepanjang hari.',
            1: 'Sebagian berawan.',
            2: 'Berawan.',
            3: 'Sangat berawan.',
            45: 'Kabut.',
            48: 'Kabut tebal.',
            51: 'Gerimis ringan.',
            53: 'Gerimis sedang.',
            55: 'Gerimis berat.',
            56: 'Gerimis beku ringan.',
            57: 'Gerimis beku berat.',
            61: 'Hujan ringan.',
            63: 'Hujan sedang.',
            65: 'Hujan berat.',
            66: 'Hujan beku ringan.',
            67: 'Hujan beku berat.',
            71: 'Salju ringan.',
            73: 'Salju sedang.',
            75: 'Salju berat.',
            77: 'Butiran salju.',
            80: 'Hujan ringan deras.',
            81: 'Hujan sedang deras.',
            82: 'Hujan berat deras.',
            85: 'Salju ringan.',
            86: 'Salju berat.',
            95: 'Badai petir ringan.',
            96: 'Badai petir dengan hujan ringan.',
            99: 'Badai petir dengan hujan berat.',
        };

        // Pilih ikon dan pesan sesuai `weatherCode`, default ke 'bi-question-circle' dan pesan umum jika tidak ada data
        const iconClass = weatherIcons[weatherCode] || 'bi-question-circle';
        const message = weatherMessages[weatherCode] || 'Data cuaca tidak tersedia.';

        return {
            iconClass,
            message
        };
    }

    function fetchWeatherData(lat, lon) {
        $.ajax({
            url: `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,precipitation,weather_code,surface_pressure,wind_speed_10m,wind_direction_10m&hourly=temperature_2m,precipitation,weather_code,surface_pressure,visibility,wind_speed_10m,wind_direction_10m,uv_index&daily=weather_code,temperature_2m_max,temperature_2m_min,uv_index_max,precipitation_sum`,
            type: "GET",
            success: function (data) {
                const values = data.current;
                const units = data.current_units;
                const hourly = data.hourly;
                const daily = data.daily;

                // Weather Prediction 
                let rainStartHour = null;
                let rainEndHour = null;
                let isClearAllDay = true;
                let weatherMessage = "Cuaca tidak diketahui.";

                const hours = hourly.time;
                const days = daily.time;
                const precipitations = hourly.precipitation;
                const weatherCodes = hourly.weather_code;

                for (let i = 0; i < hours.length; i++) {
                    const precipitation = precipitations[i];
                    const weatherCode = weatherCodes[i];

                    if (precipitation > 0) {
                        // Jika hujan ditemukan
                        if (rainStartHour === null) {
                            rainStartHour = new Date(hours[i]).getHours();
                        }
                        rainEndHour = new Date(hours[i]).getHours();
                        isClearAllDay = false;
                    }
                }

                if (isClearAllDay) {
                    weatherMessage = "Cerah sepanjang hari.";
                } else if (rainStartHour !== null && rainEndHour !== null) {
                    if (rainStartHour === rainEndHour) {
                        weatherMessage = `Hujan akan turun pukul ${rainStartHour}:00.`;
                    } else {
                        const duration = rainEndHour - rainStartHour + 1;
                        weatherMessage =
                            `Hujan akan turun mulai pukul ${rainStartHour}:00 sampai ${rainEndHour}:00, diperkirakan berlangsung sekitar ${duration} jam.`;
                    }
                }

                // Get Wind direction
                var winddir = getWindDirection(values.wind_direction_10m);

                // Get weather icons
                var weatherdata = setWeatherData(values.weather_code);

                // Get value section on html
                var temp = document.getElementById('current-temp-data');
                var prediction = document.getElementById('weather-precipitation');
                var wind = document.getElementById('wind-info');
                var icons = document.getElementById('weather-icons');
                var weatstatus = document.getElementById('weather-name');
                var carousel = document.getElementById('carousel-content');
                var tableHourly = $("#hourly-forecast-table tbody"); tableHourly.empty();
                var tableDaily = $("#daily-forecast-table tbody"); tableDaily.empty();

                // Display value to HTML
                $(temp).html(
                    `<strong>${values.temperature_2m}${units.temperature_2m}</strong>, terasa seperti <strong>${values.apparent_temperature}${units.apparent_temperature}</strong>`
                );
                $(prediction).html(`<i class="bi bi-info"></i>${weatherMessage}`);
                $(wind).html(
                    `<i class="bi bi-wind"></i> Kecepatan angin ${values.wind_speed_10m} ${units.wind_speed_10m} ke arah ${winddir}`
                );
                $(icons).html(
                    `<p class="${weatherdata.iconClass} text-center" style="font-size: 10vh; margin-bottom: -15px; font-weight: lighter !important;"></p>`
                );
                $(weatstatus).html(`${weatherdata.message}`);
                $(carousel).html(`
                    <div class="carousel-item active">
                        <div class="d-flex flex-column">
                            <div class="p-0"><small><i class="bi bi-info"></i>
                                    Wind Speed & Directions</small></div>
                            <div class="p-0">
                                <i class="bi bi-wind"></i> Kecepatan angin ${values.wind_speed_10m} ${units.wind_speed_10m} ke arah ${winddir}
                            </div>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="d-flex flex-column">
                            <div class="p-0"><small><i class="bi bi-info"></i>
                                    Precautions</small></div>
                            <div class="p-0">
                                ${weatherMessage}
                            </div>
                        </div>
                    </div>
                `);
                hours.forEach((time, index) => {
                    const weatherHourly = setWeatherData(hourly.weather_code[index]);
                    const tempHourly = hourly.temperature_2m[index];
                    const hour = new Date(time).toLocaleTimeString("id-ID", {hour: "2-digit", minute: "2-digit"});

                    const row = `
                        <td class="text-center">
                            <div class="row">
                                <div class="col-12 mb-0">
                                    <small style="font-size: 2vh; font-weight: lighter;">${hour}</small>
                                </div>
                                <div class="col-12 mb-0">
                                    <i class="${weatherHourly.iconClass}" style="font-size: 5vh;"></i>
                                </div>
                                <div class="col-12 mb-0">
                                    <p>${tempHourly} ${units.temperature_2m}</p>
                                </div>
                            </div>
                        </td>
                    `;

                    tableHourly.append(row);
                });
                days.forEach((day, index) => {
                    const weatherDaily = setWeatherData(daily.weather_code[index]);
                    const maxTempDaily = daily.temperature_2m_max[index];
                    const minTempDaily = daily.temperature_2m_min[index];
                    const day_ = new Date(day).toLocaleDateString("id-ID", {year: "numeric", month:"short", day:"2-digit"});

                    const row = `
                        <tr>
                            <td>
                                ${day_}
                            </td>
                            <td>
                                <i class="${weatherDaily.iconClass}"></i> ${weatherDaily.message}
                            </td>
                            <td>
                                ${minTempDaily} ${units.temperature_2m}
                            </td>
                            <td>
                                ${maxTempDaily} ${units.temperature_2m}
                            </td>
                        </tr>
                    `;

                    tableDaily.append(row);
                });
            },
            error: function (error) {
                console.error("Error fetching weather data:", error);
            }
        });
    }

    // Get location coordinate
    function getGeoLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(
                function (position) {
                    latitude = position.coords.latitude;
                    longitude = position.coords.longitude;

                    if (latitude, longitude) {
                        fetchWeatherData(latitude, longitude);
                        getLocationInfo(latitude, longitude);

                        $('#btnInfo').attr('data-latitude', latitude).attr('data-longitude', longitude);
                    }
                },
                function (error) {
                    console.error(error.message);
                }
            );
        } else {
            console.error('Cannot get geolocation data!');
        }
    }

    // Get location data usin nominatim api
    function getLocationInfo(lat, lon) {
        $.ajax({
            url: `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`,
            type: "GET",
            success: function (data) {
                const display_name = data.display_name;
                const addr = data.address;

                // Home
                var loc_info = document.getElementById('location-info');
                $(loc_info).html(`<i class="bi bi-geo"></i> ${addr.village}, ${addr.city}`);

                // Info
                var addr_info = document.getElementById('infoLocation');
                var lat_info = document.getElementById('infoLatitude');
                var lon_info = document.getElementById('infoLongitude');

                $(addr_info).html(`${display_name}`);
                $(lat_info).html(`${lat}`);
                $(lon_info).html(`${lon}`);
            },
            error: function (data) {
                console.error("Error fetching data:", error)
            }
        });
    }

    // Maps information
    function showMaps(lat, lon) {
        if (!maps) {
            maps = L.map('infoMaps').setView([51.505, -0.09], 2);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(maps);

            maps.setView([lat, lon], 20);
            marker = L.marker([lat, lon]).addTo(maps);
            radius = L.circle([lat, lon], {
                color: '#1b00ff',
                fillColor: '#1b00ff',
                fillOpacity: 0.3,
                radius: 50
            }).addTo(maps);
        } else {
            if ((latitude === lat) && (longitude === lon)) {
                maps.setView([lat, lon], 20);
                radius = L.circle([lat, lon], {
                    color: '#1b00ff',
                    fillColor: '#1b00ff',
                    fillOpacity: 0.3,
                    radius: 50
                }).addTo(maps);
                marker.setLatLng([lat, lon]);
            } else {
                maps.setView([lat, lon], 20);
            }
        }
    }

    // Event info modal clicked
    $('#infoModal').on('shown.bs.modal', function () {
        const data_btn = document.getElementById('btnInfo');
        const lat = data_btn.dataset.latitude;
        const lon = data_btn.dataset.longitude;

        showMaps(lat, lon); // Panggil fungsi showMaps untuk menampilkan peta

        // Memastikan peta diperbarui sesuai ukuran kontainer
        setTimeout(function () {
            maps.invalidateSize();
        }, 200);
    });

    $(document).ready(function () {
        getGeoLocation();

        // Set interval untuk merefresh data setiap 15 menit (900000 ms)
        setInterval(getGeoLocation, 900000); // 15 menit dalam milidetik
    });
</script>

</html>